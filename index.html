<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ë°°ë“œë¯¼í„´ ëŒ€ì§„í‘œ & ëˆ„ì  ì ìˆ˜ ê¸°ë¡</title>
<style>
body{font-family:'Noto Sans KR',sans-serif;margin:0;background:#f7fafc;padding:20px;}
.container{max-width:1200px;margin:0 auto;background:white;padding:20px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.05);}
h1{margin-top:0;text-align:center;}
input,select,button{padding:6px;margin:4px;border-radius:8px;border:1px solid #ccc;}
button{background:#2563eb;color:white;border:none;cursor:pointer;}
button:hover{background:#1d4ed8;}
.players, .match, .leftovers, .storage, .scores{margin-top:10px;padding:10px;border-radius:8px;}
.players{border:1px dashed #ccc;min-height:40px;}
.match{background:#e0f2fe;margin-bottom:8px;padding:8px;border-radius:8px;}
.leftovers{background:#fff3cd;border:1px solid #ffeeba;padding:8px;border-radius:8px;margin-top:10px;}
.court{font-weight:bold;}
.small{font-size:13px;color:#475569;margin-bottom:8px;}
.delete-btn{background:#dc2626;color:white;border:none;border-radius:4px;padding:2px 6px;font-size:12px;cursor:pointer;margin-left:4px;}
.delete-btn:hover{background:#b91c1c;}
input.score-input{width:50px;}
table{width:100%;border-collapse:collapse;margin-top:8px;}
th,td{padding:6px;border-bottom:1px solid #eee;text-align:left;}
.saved-item{display:inline-block;width:32%;margin:4px;padding:4px;border:1px solid #ccc;border-radius:6px;background:#f1f5f9;vertical-align:top;}
.saved-item button{margin-top:2px;padding:2px 6px;font-size:12px;display:block;width:100%;}
</style>
</head>
<body>
<div class="container">
<h1>ğŸ¸ ë°°ë“œë¯¼í„´ ëŒ€ì§„í‘œ & ëˆ„ì  ì ìˆ˜ ê¸°ë¡</h1>

<!-- ì„ ìˆ˜ ë“±ë¡ -->
<div>
<input id="name" placeholder="ì´ë¦„ ì…ë ¥" />
<select id="age"><option>20ëŒ€</option><option>30ëŒ€</option><option>40ëŒ€</option><option>50ëŒ€</option><option>60ëŒ€</option></select>
<select id="gender"><option>ë‚¨ì</option><option>ì—¬ì</option></select>
<select id="group"><option>Aì¡°</option><option>Bì¡°</option><option>Cì¡°</option><option>Dì¡°</option><option>Eì¡°</option></select>
<input id="rating" type="number" min="0" max="100" placeholder="í‰ì (0~100)" style="width:100px;" />
<span class="small">Eì¡°(0~20) Dì¡°(21~40) Cì¡°(41~60) Bì¡°(61~80) Aì¡°(81~100), ê¸°ë³¸ê°’ ì¤‘ê°„ê°’</span>
<button onclick="addPlayer()">ì¶”ê°€</button>
</div>

<!-- ë“±ë¡ ì„ ìˆ˜ ëª©ë¡ -->
<div class="players" id="playerList">ë“±ë¡ëœ ì„ ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.</div>

<!-- ëŒ€ì§„í‘œ ìƒì„±/ì½”íŠ¸ -->
<div style="margin-top:12px;">
<select id="courtCount">
<option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option selected>8</option>
</select> ì½”íŠ¸
<button onclick="makeDraw(false)">ì „ì²´ ë°¸ëŸ°ìŠ¤ ëŒ€ì§„í‘œ ìƒì„±</button>
<button onclick="makeDraw(true)">ì¡°ë³„ ë°¸ëŸ°ìŠ¤ ëŒ€ì§„í‘œ ìƒì„±</button>
<button onclick="resetCourts()">ì½”íŠ¸ ì´ˆê¸°í™”</button>
</div>

<!-- ì„ ìˆ˜ ëª…ë‹¨ ì €ì¥ -->
<div class="storage">
<h3>ğŸ’¾ ì„ ìˆ˜ ëª…ë‹¨ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°</h3>
<input id="saveName" placeholder="ì €ì¥ ì´ë¦„ ì…ë ¥" />
<button onclick="savePlayers()">ì €ì¥</button>
<button onclick="addAllSavedToDraw()">ì €ì¥ ëª…ë‹¨ ì „ì²´ ëŒ€ì§„í‘œ ì¶”ê°€</button>
<div id="savedLists"></div>
</div>

<!-- ëŒ€ì§„í‘œ -->
<div id="draw"></div>

<!-- ëˆ„ì  ì ìˆ˜ -->
<div class="scores">
<h3>ğŸ“Š ì„ ìˆ˜ë³„ ëˆ„ì  ì ìˆ˜ (ìµœëŒ€ 10ê²Œì„)</h3>
<div id="playerScores"></div>
</div>

<script>
//==================== ë°ì´í„° êµ¬ì¡° ====================//
let players = JSON.parse(localStorage.getItem('currentPlayers')) || [];
let matchesData = JSON.parse(localStorage.getItem('matchesData')) || [];
let playerScores = JSON.parse(localStorage.getItem('playerScores')) || {};
let courtStatus = Array(8).fill(false);

//==================== ì„ ìˆ˜ ê´€ë¦¬ ====================//
function saveCurrent(){
  localStorage.setItem('currentPlayers', JSON.stringify(players));
  localStorage.setItem('matchesData', JSON.stringify(matchesData));
  localStorage.setItem('playerScores', JSON.stringify(playerScores));
}

function addPlayer(){
  const name=document.getElementById('name').value.trim();
  const age=document.getElementById('age').value;
  const gender=document.getElementById('gender').value;
  let group=document.getElementById('group').value;
  let rating=parseInt(document.getElementById('rating').value);
  if(!name) return alert('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”!');
  if(!rating) rating=50;
  if(players.length>=50) return alert('ìµœëŒ€ 50ëª…ê¹Œì§€ ë“±ë¡ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
  if(rating>=81) group='Aì¡°'; else if(rating>=61) group='Bì¡°'; else if(rating>=41) group='Cì¡°'; else if(rating>=21) group='Dì¡°'; else group='Eì¡°';
  players.push({name,age,gender,group,rating});
  document.getElementById('name').value='';
  document.getElementById('rating').value='';
  renderPlayers();
  saveCurrent();
}

function deletePlayer(index){
  if(!confirm(players[index].name+' ì„ ìˆ˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  players.splice(index,1);
  renderPlayers();
  saveCurrent();
}

//==================== ë“±ë¡ ì„ ìˆ˜ ë Œë”ë§ ====================//
function renderPlayers(){
  const list=document.getElementById('playerList');
  if(players.length===0){ list.innerHTML='ë“±ë¡ëœ ì„ ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.'; return; }
  list.innerHTML=players.map((p,i)=>`<div>${i+1}. ${p.name} (${p.age}, ${p.gender}, ${p.group}, í‰ì :${p.rating})
    <button class='delete-btn' onclick='deletePlayer(${i})'>ì‚­ì œ</button>
    <button class='delete-btn' onclick='savePlayerToList(${i})'>ëª…ë‹¨ ì €ì¥</button>
  </div>`).join('');
}

//==================== ëª…ë‹¨ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ====================//
function savePlayerToList(index){
  let savedLists = JSON.parse(localStorage.getItem('savedLists') || '[]');
  savedLists.push(players[index]);
  localStorage.setItem('savedLists', JSON.stringify(savedLists));
  renderSavedLists();
}

function renderSavedLists(){
  const div=document.getElementById('savedLists');
  let savedLists=JSON.parse(localStorage.getItem('savedLists')||'[]');
  if(savedLists.length===0){ div.innerHTML='ì €ì¥ëœ ëª…ë‹¨ì´ ì—†ìŠµë‹ˆë‹¤.'; return; }
  let html='';
  for(let i=0;i<savedLists.length;i+=3){
    html+='<div style="display:flex;">';
    for(let j=0;j<3;j++){
      if(savedLists[i+j]){
        const p=savedLists[i+j];
        html+=`<div class="saved-item">${p.name} (${p.age},${p.gender},${p.group},í‰ì :${p.rating})
          <button onclick='loadSavedPlayer(${i+j})'>ëŒ€ì§„í‘œ ì¶”ê°€</button>
          <button onclick='deleteSavedPlayer(${i+j})'>ì‚­ì œ</button>
        </div>`;
      }
    }
    html+='</div>';
  }
  div.innerHTML=html;
}

function loadSavedPlayer(index){
  let savedLists=JSON.parse(localStorage.getItem('savedLists')||'[]');
  players.push(savedLists[index]);
  renderPlayers();
  saveCurrent();
}

function deleteSavedPlayer(index){
  let savedLists=JSON.parse(localStorage.getItem('savedLists')||'[]');
  savedLists.splice(index,1);
  localStorage.setItem('savedLists', JSON.stringify(savedLists));
  renderSavedLists();
}

function addAllSavedToDraw(){
  let savedLists=JSON.parse(localStorage.getItem('savedLists')||'[]');
  savedLists.forEach(p=>players.push(p));
  renderPlayers();
  saveCurrent();
}

//==================== ëŒ€ì§„í‘œ ìƒì„± ====================//
function shuffle(array){ for(let i=array.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [array[i],array[j]]=[array[j],array[i]];} return array; }

function makeDraw(byGroup){
  if(players.length<4) return alert('ìµœì†Œ 4ëª… ì´ìƒ ë“±ë¡í•´ì•¼ í•©ë‹ˆë‹¤.');
  let targetPlayers=players.slice();
  if(byGroup){
    let group=prompt('ì¡°(A~E) ì…ë ¥').toUpperCase();
    let filtered=targetPlayers.filter(p=>p.group===group+'ì¡°');
    if(filtered.length<4){ filtered=targetPlayers.sort((a,b)=>Math.abs(a.rating-50)-Math.abs(b.rating-50)).slice(0,Math.max(4,filtered.length)); }
    targetPlayers=filtered;
  }
  targetPlayers=targetPlayers.sort((a,b)=>b.rating-a.rating);
  const matches=[];
  while(targetPlayers.length>=4 && matches.length<8){
    const team1=[targetPlayers.shift(),targetPlayers.pop()];
    const team2=[targetPlayers.shift(),targetPlayers.pop()];
    matches.push([team1,team2]);
  }
  renderDraw(matches);
}

//==================== ëŒ€ì§„í‘œ ë Œë”ë§ ====================//
function renderDraw(matchList){
  const draw=document.getElementById('draw');
  matchesData=[];
  draw.innerHTML='';
  matchList.forEach((m,i)=>{
    matchesData.push({team1:m[0],team2:m[1],score:[0,0]});
    let html=`<div class='match'><b>ê²½ê¸° ${i+1}</b>`;
    html+=`<div>${m[0].map(p=>p.name).join(', ')} VS ${m[1].map(p=>p.name).join(', ')}</div>`;
    html+=`<div>ì ìˆ˜: <input class='score-input' type='number' min='0' max='25' onchange='updateScore(${i},0,this.value)' /> :
           <input class='score-input' type='number' min='0' max='25' onchange='updateScore(${i},1,this.value)' /></div>`;
    html+='</div>';
    draw.innerHTML+=html;
  });
  saveCurrent();
  renderPlayerScores();
}

//==================== ì ìˆ˜ ì—…ë°ì´íŠ¸ ====================//
function updateScore(matchIndex,teamIndex,val){
  val=parseInt(val); if(isNaN(val)) val=0;
  matchesData[matchIndex].score[teamIndex]=val;
  // ëˆ„ì  ì ìˆ˜ ê¸°ë¡
  matchesData[matchIndex].team1.concat(matchesData[matchIndex].team2).forEach(p=>{
    if(!playerScores[p.name]) playerScores[p.name]=[];
  });
  updatePlayerScores();
  saveCurrent();
}

//==================== ëˆ„ì  ì ìˆ˜ ê³„ì‚° ====================//
function updatePlayerScores(){
  Object.keys(playerScores).forEach(name=>{
    playerScores[name]=[];
  });
  matchesData.forEach(m=>{
    m.team1.forEach(p=>{playerScores[p.name].push(m.score[0]); if(playerScores[p.name].length>10) playerScores[p.name].shift();});
    m.team2.forEach(p=>{playerScores[p.name].push(m.score[1]); if(playerScores[p.name].length>10) playerScores[p.name].shift();});
  });
  renderPlayerScores();
}

function renderPlayerScores(){
  const div=document.getElementById('playerScores');
  let html='<table><tr><th>ì´ë¦„</th><th>ì ìˆ˜ ë‚´ì—­</th><th>ì´ì </th></tr>';
  Object.keys(playerScores).sort().forEach(name=>{
    const scores=playerScores[name];
    const total=scores.reduce((a,b)=>a+b,0);
    html+=`<tr><td>${name}</td><td>${scores.join(', ')}</td><td>${total}</td></tr>`;
  });
  html+='</table>';
  div.innerHTML=html;
}

//==================== ì½”íŠ¸ ì´ˆê¸°í™” ====================//
function resetCourts(){
  if(confirm('ì ìˆ˜ë¥¼ ìœ ì§€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){} else {playerScores={};}
  matchesData=[];
  renderDraw([]);
  saveCurrent();
}

//==================== ëª…ë‹¨ ì €ì¥ ====================//
function savePlayers(){
  const name=document.getElementById('saveName').value.trim();
  if(!name) return alert('ì €ì¥ ì´ë¦„ ì…ë ¥');
  let savedLists=JSON.parse(localStorage.getItem('savedLists')||'[]');
  players.forEach(p=>savedLists.push(p));
  localStorage.setItem('savedLists',JSON.stringify(savedLists));
  renderSavedLists();
  document.getElementById('saveName').value='';
}

//==================== ì´ˆê¸° ë Œë”ë§ ====================//
renderPlayers();
renderSavedLists();
renderPlayerScores();

</script>
</div>
</body>
</html>
